import{m as C,r as f,j as e,L as I,a as u}from"./app-BvaRJVLE.js";import{G as U}from"./GuestLayout-BpLaOevY.js";function P(){const{data:p,setData:y}=C({images:[],format:"jpg"}),[r,c]=f.useState([]),m=async t=>{const a=Array.from(t.target.files),s=r.length??0;a.forEach((l,n)=>{const i={file:l,name:"",path:URL.createObjectURL(l),status:"Uploading",progress:0};c(o=>[...o,i])}),a.forEach((l,n)=>{const i=new FormData;i.append("image",l),u.post(route("file.upload"),i,{onUploadProgress:o=>{const h=Math.round(o.loaded*100/o.total);c(d=>{const j=[...d];return j[s+n].progress=h,j})}}).then(o=>{c(h=>{const d=[...h];return d[s+n]={...d[s+n],name:o.data.name,path:o.data.path,status:"Uploaded"},d})}).catch(o=>{console.error("Lỗi upload:",o),c(h=>{const d=[...h];return d[s+n].status="Failed",d})})}),t.target.value=null},x=async t=>{const a=new FormData;a.append("path",r[t].path),a.append("name",r[t].name),a.append("format",p.format),u.post(route("convert.process"),a,{onUploadProgress:s=>{const l=Math.round(s.loaded*100/s.total);c(n=>{const i=[...n];return i[t].progress=l,i})}}).then(s=>{c(l=>{const n=[...l];return n[t]={...n[t],path:s.data.path,name:s.data.name,status:"Converted"},n})}).catch(s=>{console.error("Lỗi chuyển đổi:",s)})},v=t=>{c(a=>a.filter((s,l)=>l!==t))},g=r.length>0&&r.every(t=>t.status==="Converted"),w=async()=>{try{const t=await u.post(route("file.download"),{images:r},{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.href=a,s.setAttribute("download","lumipic-convert.zip"),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(a)}catch(t){console.error("Lỗi khi tải file ZIP:",t)}},[N,b]=f.useState(!1);return e.jsx(U,{children:e.jsxs("div",{className:"p-5 container mx-auto",children:[e.jsx(I,{title:"Image Converter"}),e.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Chuyển đổi hình ảnh của bạn"}),e.jsx("p",{className:"text-center",children:"Chuyển đổi hình ảnh PNG, GIF, TIF, PSD, SVG, WEBP, HEIC hoặc RAW sang JPG, PNG, WEBP hoặc GIF hàng loạt dễ dàng."}),e.jsx("p",{className:"text-center my-3",children:"Chọn định dạng bạn muốn chuyển đổi hình ảnh của mình thành và tải lên hình ảnh của bạn bên dưới."}),e.jsx("div",{className:"flex justify-center items-center mb-3",children:e.jsxs("label",{className:"w-full max-w-lg p-5 border-2 border-dashed border-gray-300 rounded-lg text-center cursor-pointer flex items-center justify-center",style:{height:"200px"},children:[e.jsx("span",{className:"text-gray-500",children:"Nhấp để tải lên hoặc kéo và thả"}),e.jsx("input",{type:"file",multiple:!0,onChange:m,className:"hidden"})]})}),e.jsxs("select",{value:p.format,onChange:t=>y("format",t.target.value),className:"mb-3 block mx-auto",children:[e.jsx("option",{value:"jpg",children:"JPG"}),e.jsx("option",{value:"png",children:"PNG"}),e.jsx("option",{value:"webp",children:"WEBP"}),e.jsx("option",{value:"gif",children:"GIF"})]}),r.length>0&&e.jsxs("div",{className:"mt-5",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Hình ảnh đã tải lên:"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 mt-3",children:[e.jsxs("div",{className:"border p-3 rounded flex justify-between",children:[e.jsx("div",{className:"flex items-center justify-between",children:g?"Tải xuống tất cả hình ảnh":"Chuyển đổi tất cả hình ảnh"}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("button",{onClick:()=>c([]),className:"bg-red-500 text-white px-4 py-2 rounded",children:"Xóa tất cả"}),g?e.jsx("button",{className:"bg-blue-500 text-white px-4 py-2 rounded",onClick:async()=>{b(!0),await w(),b(!1)},children:N?"Đang chuẩn bị file...":"Tải xuống tất cả"}):e.jsx("button",{onClick:()=>r.forEach((t,a)=>x(a)),className:"bg-blue-500 text-white px-4 py-2 rounded",children:"Chuyển đổi tất cả"})]})]}),r.map((t,a)=>e.jsx("div",{className:"border p-3 rounded",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"w-20 h-20 mr-3",children:e.jsx("img",{src:t.path,alt:`Uploaded ${a}`,className:"w-full h-full object-cover border rounded"})}),e.jsx("p",{className:"font-semibold truncate w-1/4",children:t.name}),e.jsx("p",{className:"w-1/4 text-right flex justify-center",children:e.jsx("span",{className:`text-sm p-1 px-2 rounded-sm ${t.status==="Uploading"?"bg-yellow-200":t.status==="Uploaded"?"bg-green-200":t.status==="Converted"?"bg-blue-200":t.status==="Failed"?"bg-red-200":"bg-gray-200"}`,children:t.status==="Converting"?"Đang chuyển đổi":t.status})}),e.jsx("div",{className:"w-1/4 flex justify-center items-center",children:(t.status==="Uploading"||t.status==="Converting")&&e.jsx("div",{className:"bg-gray-200 h-2.5 rounded-full w-1/2",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${t.progress}%`}})})}),e.jsxs("div",{className:"w-1/4 text-right flex items-center justify-end",children:[t.status==="Failed"&&e.jsx("button",{onClick:()=>m({target:{files:[t.file]}}),className:"bg-blue-500 text-white px-4 py-2 rounded",children:"Thử lại"}),t.status==="Uploaded"&&e.jsx("button",{onClick:()=>x(a),className:"bg-blue-500 text-white px-4 py-2 rounded",children:"Chuyển đổi"}),t.status==="Converted"&&e.jsx("a",{href:t.path,download:t.name,className:"bg-blue-500 text-white px-4 py-2 rounded",children:"Tải xuống"}),e.jsx("button",{onClick:()=>v(a),className:"ml-2 text-red-500",children:"✖"})]})]})},a))]})]})]})})}export{P as default};
