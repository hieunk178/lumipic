import{m as L,r as u,j as e,L as U,a as m}from"./app-BvaRJVLE.js";import{G as k}from"./GuestLayout-BpLaOevY.js";function q(){L({images:[]});const[o,r]=u.useState([]),[p,y]=u.useState("85"),f=async t=>{const a=Array.from(t.target.files),s=o.length??0;a.forEach((n,l)=>{const i={file:n,name:"",path:URL.createObjectURL(n),status:"Uploading",progress:0,quality:p};r(c=>[...c,i])}),a.forEach((n,l)=>{const i=new FormData;i.append("image",n),m.post(route("file.upload"),i,{onUploadProgress:c=>{const h=Math.round(c.loaded*100/c.total);r(d=>{const b=[...d];return b[s+l].progress=h,b})}}).then(c=>{r(h=>{const d=[...h];return d[s+l]={...d[s+l],name:c.data.name,path:c.data.path,status:"Uploaded"},d})}).catch(c=>{console.error("Lỗi upload:",c),r(h=>{const d=[...h];return d[s+l].status="Failed",d})})}),t.target.value=null},x=async t=>{const a=new FormData;a.append("path",o[t].path),a.append("name",o[t].name),a.append("quality",o[t].quality),m.post(route("compress.process"),a,{onUploadProgress:s=>{const n=Math.round(s.loaded*100/s.total);r(l=>{const i=[...l];return i[t].progress=n,i})}}).then(s=>{r(n=>{const l=[...n];return l[t]={...l[t],path:s.data.path,name:s.data.name,status:"Converted"},l})}).catch(s=>{console.error("Lỗi chuyển đổi:",s)})},v=t=>{r(a=>a.filter((s,n)=>n!==t))},w=t=>{const a=t.target.value;y(a),r(s=>s.map(n=>({...n,quality:a})))},N=(t,a)=>{r(s=>{const n=[...s];return n[t].quality=a,n})},g=o.length>0&&o.every(t=>t.status==="Converted"),C=async()=>{try{const t=await m.post(route("file.download"),{images:o},{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.href=a,s.setAttribute("download","lumipic-convert.zip"),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(a)}catch(t){console.error("Lỗi khi tải file ZIP:",t)}},[I,j]=u.useState(!1);return e.jsx(k,{children:e.jsxs("div",{className:"p-5 container mx-auto",children:[e.jsx(U,{title:"Image Compressor"}),e.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Nén hình ảnh của bạn"}),e.jsx("p",{className:"text-center",children:"Chọn hình ảnh từ máy tính của bạn và chúng tôi sẽ giúp bạn nén chúng."}),e.jsx("div",{className:"flex justify-center items-center mb-3",children:e.jsxs("label",{className:"w-full max-w-lg p-5 border-2 border-dashed border-gray-300 rounded-lg text-center cursor-pointer flex items-center justify-center",style:{height:"200px"},children:[e.jsx("span",{className:"text-gray-500",children:"Nhấp để tải lên hoặc kéo và thả"}),e.jsx("input",{type:"file",multiple:!0,onChange:f,className:"hidden"})]})}),e.jsxs("div",{className:"mb-3 text-center",children:[e.jsx("label",{className:"mr-2",children:"Chất lượng ảnh chung sau nén:"}),e.jsxs("select",{value:p,onChange:w,children:[e.jsx("option",{value:"85",children:"85%"}),e.jsx("option",{value:"75",children:"75%"}),e.jsx("option",{value:"50",children:"50%"}),e.jsx("option",{value:"25",children:"25%"})]})]}),o.length>0&&e.jsxs("div",{className:"mt-5",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Hình ảnh đã tải lên:"}),e.jsxs("div",{className:"border p-3 rounded flex justify-between",children:[e.jsx("div",{className:"flex items-center justify-between",children:g?"Tải xuống tất cả hình ảnh":"Chuyển đổi tất cả hình ảnh"}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("button",{onClick:()=>r([]),className:"bg-red-500 text-white px-4 py-2 rounded",children:"Xóa tất cả"}),g?e.jsx("button",{className:"bg-blue-500 text-white px-4 py-2 rounded",onClick:async()=>{j(!0),await C(),j(!1)},children:I?"Đang chuẩn bị file...":"Tải xuống tất cả"}):e.jsx("button",{onClick:()=>o.forEach((t,a)=>x(a)),className:"bg-blue-500 text-white px-4 py-2 rounded",children:"Chuyển đổi tất cả"})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4 mt-3",children:o.map((t,a)=>e.jsx("div",{className:"border p-3 rounded",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"w-20 h-20 mr-3",children:e.jsx("img",{src:t.path,alt:`Uploaded ${a}`,className:"w-full h-full object-cover border rounded"})}),e.jsx("p",{className:"font-semibold truncate w-1/4",children:t.name}),e.jsxs("div",{className:"w-1/4",children:[e.jsx("label",{className:"mr-2",children:"Chất lượng ảnh sau khi nén:"}),e.jsxs("select",{value:t.quality,onChange:s=>N(a,s.target.value),children:[e.jsx("option",{value:"85",children:"85%"}),e.jsx("option",{value:"75",children:"75%"}),e.jsx("option",{value:"50",children:"50%"}),e.jsx("option",{value:"25",children:"25%"})]})]}),e.jsxs("div",{className:"w-1/4 text-right flex items-center justify-end",children:[t.status==="Uploaded"&&e.jsx("button",{onClick:()=>x(a),className:"bg-blue-500 text-white px-4 py-2 rounded",children:"Chuyển đổi"}),t.status==="Converted"&&e.jsx("a",{href:t.path,download:t.name,className:"bg-blue-500 text-white px-4 py-2 rounded",children:"Tải xuống"}),e.jsx("button",{onClick:()=>v(a),className:"ml-2 text-red-500",children:"✖"})]})]})},a))})]})]})})}export{q as default};
